<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How it works - Just Write It</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Just Write It</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
            <li class="toctree-l1 ">
                <a class="" href="..">Home</a>
                
            </li>
        

    
        
            <li class="toctree-l1 current">
                <a class="current" href="./">How it works</a>
                
                    <ul>
                    
                        <li class="toctree-l3"><a href="#step-1-generate-html-with-textangular">Step 1: Generate HTML with textAngular</a></li>
                        
                            <li><a class="toctree-l4" href="#generated-html">Generated HTML</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-2-html-is-sent-to-server">Step 2: HTML is sent to server</a></li>
                        
                            <li><a class="toctree-l4" href="#frontend-controller-code-involved-simplified">Frontend controller code involved (simplified)</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-3-server-recieves-post-request">Step 3: Server recieves post request</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-4-parse-the-html-string-to-a-dom-object">Step 4: Parse the HTML string to a DOM object</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-5-parse-the-dom-object-to-a-latex-string">Step 5: Parse the DOM object to a latex string</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-6-include-generated-latex-in-article-template">Step 6: Include generated latex in article template</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-7-write-latex-string-to-file">Step 7: Write latex string to file</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-8-compile-documenttex">Step 8: Compile document.tex</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-9-send-result-back-to-client">Step 9: Send result back to client</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-10-client-handles-the-return">Step 10: Client handles the return</a></li>
                        
                    
                        <li class="toctree-l3"><a href="#step-11-repeat-the-refresh-every-10-seconds">Step 11: Repeat the refresh every 10 seconds</a></li>
                        
                    
                    </ul>
                
            </li>
        

    
        
            <span>Server</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../server/">Overview</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../server/routes/">Routes</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../server/models/">Models</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../server/texFiles/">_texFiles</a>
                    
                </li>
            
        

    
        
            <span>Parser</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../parser/">Overview</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../parser/code/">Code</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../parser/templates/">Templates</a>
                    
                </li>
            
        

    
        
            <span>Client</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../client/">Overview</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../client/controller/">Controller</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../client/templates/">HTML Templates</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Just Write It</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
    <li>How it works</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <h2 id="step-1-generate-html-with-textangular">Step 1: Generate HTML with textAngular</h2>
<p><img alt="textAngular view" src=".././img/textAngular.png" /></p>
<h3 id="generated-html">Generated HTML</h3>
<pre><code class="html">&lt;ol&gt;
  &lt;li&gt;list item&lt;/li&gt;
  &lt;li&gt;another list item&lt;/li&gt;
&lt;/ol&gt;
</code></pre>

<h2 id="step-2-html-is-sent-to-server">Step 2: HTML is sent to server</h2>
<p>See <a href=".././client/controller/">Client &gt; Controller</a> for more information.</p>
<p>While typing angular.js keeps <code>$scope.data.htmlContent</code> updated</p>
<pre><code class="js">$scope.data.htmlContent = '&lt;ol&gt;&lt;li&gt;list item&lt;/li&gt;&lt;li&gt;another list item&lt;/li&gt;&lt;/ol&gt;';
</code></pre>

<h3 id="frontend-controller-code-involved-simplified">Frontend controller code involved (simplified)</h3>
<pre><code class="js">function refresh() {

  var postData = {
    &quot;htmlCode&quot;: '&lt;ol&gt;&lt;li&gt;list item&lt;/li&gt;&lt;li&gt;another list item&lt;/li&gt;&lt;/ol&gt;', 
    &quot;type&quot;: 'article',
  }

  $http.post(&quot;/company/document/compile&quot;, postData)
  .success(function(data, status, headers, config) {
    if (status === 'success') {
      // update preview
    } 
  });
};
</code></pre>

<h2 id="step-3-server-recieves-post-request">Step 3: Server recieves post request</h2>
<p>See <a href=".././server/routes/#routes">Server &gt; Routes</a> for more information.</p>
<p>The request <code>$http.post("/company/document/compile", postData)</code> triggers <code>app.post('/:group/:document/compile', function(request, response){}</code> where the postData now is in <code>request.params</code>. </p>
<pre><code class="javascript">app.post('/:group/:document/compile', function(request, response){
  var filename = request.params.document.split('.')[0];
  var group  = request.params.group.split('.')[0];

  var latexType = request.body.type;
  var html = request.body.htmlCode;
  var latexCode = '';

}
</code></pre>

<p>With that new input the parser gets called.</p>
<pre><code class="js">var parsedLatex = Parser('parseComplete', ['&lt;ol&gt;&lt;li&gt;list item&lt;/li&gt;&lt;li&gt;another list item&lt;/li&gt;&lt;/ol&gt;'], {latexType: 'article'});
</code></pre>

<h2 id="step-4-parse-the-html-string-to-a-dom-object">Step 4: Parse the HTML string to a DOM object</h2>
<p>See <a href=".././parser/code">Parser &gt; Code</a> for more information.</p>
<p>The <code>htmlparser2.parseComplete</code> call first generates a DOM object from the html input</p>
<pre><code class="js">[{
  type: 'tag'
  name: 'ol'
  attribs: {}
  children: [
    {
        type: 'tag'
        name: 'li'
        attribs: {}
        children: [
          {
            data: 'list item'
            type: 'text'
            next: null
            prev: null
            parent: {+}
          }
        ]
        next: {+}
        prev: {+}
        parent: {+}
    },{
        type: 'tag'
        name: 'li'
        attribs: {}
        children: [
          {
            data: 'another list item'
            type: 'text'
            next: null
            prev: null
            parent: {+}
          }
        ]
        next: {+}
        prev: {+}
        parent: {+}
    }
  ]
  next: null
  prev: null
  parent: null
}]
</code></pre>

<h2 id="step-5-parse-the-dom-object-to-a-latex-string">Step 5: Parse the DOM object to a latex string</h2>
<p>The simplified recursive call uses <a href="https://github.com/maxxst/latex-sanitizer">sanitizeLatex</a> and the <a href=".././parser/templates/">templates</a></p>
<pre><code class="js">function domToLatex(node, classType) {
  // end of recursion
  if (node.type === 'text') {
    return sanitizeLatex(node.data);
  }

  if (node.type === 'tag') {
    for (var i = 0; i &lt; node.children.length; i++) {
      text += domToLatex(node.children[i], classType);
    };

    // use tag templates
    return templates[article][tag_name]({&quot;content&quot;: text});
  }
}
</code></pre>

<p>With that <code>&lt;ol&gt;&lt;li&gt;list item&lt;/li&gt;&lt;li&gt;another list item&lt;/li&gt;&lt;/ol&gt;</code> becomes </p>
<pre><code class="latex">\begin{enumerate}
  \item list item
  \item another list item
\end{enumerate}
</code></pre>

<p>This latex string is now returned back into the <a href=".././server/routes/#compilejs">compile route</a>.</p>
<h2 id="step-6-include-generated-latex-in-article-template">Step 6: Include generated latex in article template</h2>
<p>See <a href=".././server/texFiles/#dotjs-files">Server &gt; _texFiles</a> for more information about the article template.</p>
<p>With the line <code>latexCode = latexTemplates.article({latexCode: parsedLatex})</code> the latex string is now:</p>
<pre><code class="latex">\documentclass{defaultArticle}
\begin{document}

\begin{enumerate}
  \item list item
  \item another list item
\end{enumerate}

\end{document}
</code></pre>

<h2 id="step-7-write-latex-string-to-file">Step 7: Write latex string to file</h2>
<p>The new latex string is passed to the <a href=".././server/models/#compilerjs">Server &gt; Models &gt; compiler.js</a> where it is saved to <code>document.tex</code>.</p>
<pre><code class="js">fs.writeFile(fileInDirectory, latexCode, function(err){
  var tex = new pdflatex(fileInDirectory, outputDirectory, doc);
  tex.compile();
}
</code></pre>

<h2 id="step-8-compile-documenttex">Step 8: Compile document.tex</h2>
<p>The <code>document.tex</code> is now handed over to <a href=".././server/models/#pdflatexjs">Server &gt; Models &gt; pdflatex.js</a> where the pdflatex command is started.</p>
<pre><code class="javascript">var command = &quot;pdflatex -interaction nonstopmode -output-directory &quot; + this.outputDirectory + &quot; &quot; + this.inputPath;
exec(command);
</code></pre>

<h2 id="step-9-send-result-back-to-client">Step 9: Send result back to client</h2>
<p>If <code>pdflatex</code> is successful the url to the new pdf is sent back. Otherwise an error is sent to the client.</p>
<pre><code class="javascript">if (error !== null) {
  // if pdflatex fails call _callback with an error
  _callback({error: 'Could not create ' + parent.filename + '.pdf'});
} else {
  // if pdflatex succeds call _callback with the new path to pdf
  _callback({filePath: __server + '_texFiles/' + parent.filename +'.pdf'});
}
</code></pre>

<h2 id="step-10-client-handles-the-return">Step 10: Client handles the return</h2>
<p>In this given example the <code>refresh</code> call started the whole chain. Therefore <code>pdfDelegate.$getByHandle('pdf-preview').load(data.redirect);</code> is called in <a href=".././client/controller/#editor-index-controller">Client &gt; Controller</a>. That reloads the pdf-preview.</p>
<h2 id="step-11-repeat-the-refresh-every-10-seconds">Step 11: Repeat the refresh every 10 seconds</h2>
<p>The refresh call is repeated every 10 seconds.</p>
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../server/" class="btn btn-neutral float-right" title="Overview"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="../server/" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>

<!--
MkDocs version  : 0.12.1
Docs Build Date : 2015-05-01 21:01:22.447445
-->
</body>
</html>